{"version":3,"file":"index.umd.js","sources":["../src/utils.js","../src/ReactStickyHeader.js"],"sourcesContent":["// @flow\n\nexport function addEvent (event: string, cb: Function) {\n  window.addEventListener(event, cb, false);\n  return () => window.removeEventListener(event, cb, false);\n}\n","// @flow\n\nimport type { Children } from 'react';\nimport React, { Component } from 'react';\nimport { addEvent } from './utils';\n\nconst noop: any = () => {};\n\ntype Props = {\n  onSticky: (isSticky: boolean) => void,\n  header: Children,\n  headerOnly: boolean,\n  children?: Children,\n  backgroundImage?: string,\n  backgroundColor?: string,\n  className?: string,\n};\n\nexport default class ReactStickyHeader extends Component {\n  // eslint-disable-next-line react/sort-comp\n  props: Props;\n  _detatch: () => void = noop;\n  _initialised: boolean;\n  _fixed: HTMLElement;\n  _root: HTMLElement;\n  _rafExecuting = false;\n\n  static defaultProps = {\n    onSticky: noop,\n    headerOnly: false,\n  };\n\n  state = {\n    isSticky: this.props.headerOnly,\n  };\n\n  componentDidMount () {\n    this.initialise();\n    // Force state change as we need to calculate the header background containers.\n    // eslint-disable-next-line react/no-did-mount-set-state\n    this.setState({});\n  }\n\n  componentWillUnmount () {\n    this._detatch();\n  }\n\n  componentWillReceiveProps (nextProps: Props) {\n    if (nextProps.headerOnly !== this.props.headerOnly) {\n      this.calculateStickyState();\n    }\n  }\n\n  calculateStickyState = () => {\n    if (this._rafExecuting) {\n      return;\n    }\n\n    this._rafExecuting = true;\n\n    requestAnimationFrame(() => {\n      const stickyHeaderHeight = this._fixed.offsetHeight;\n      const headerContainer = this._root.offsetHeight;\n      const headerContainerBoundingBox = this._root.getBoundingClientRect();\n      const pastStickyThreshold = ((headerContainer + headerContainerBoundingBox.top) - stickyHeaderHeight) <= 0;\n\n      if (pastStickyThreshold && !this.state.isSticky) {\n        this.setState({\n          isSticky: true,\n        });\n\n        this.props.onSticky(true);\n      } else if (!pastStickyThreshold && this.state.isSticky) {\n        this.setState({\n          isSticky: false,\n        });\n\n        this.props.onSticky(false);\n      }\n\n      this._rafExecuting = false;\n    });\n  };\n\n  onResize = () => {\n    // We want to flush a re-render incase the children have changed size from CSS.\n    this.setState({});\n\n    // We want to check if because of a resize the header is now sticky or not.\n    this.calculateStickyState();\n  };\n\n  initialise () {\n    if (this._initialised) {\n      return;\n    }\n\n    const detatchScroll = addEvent('scroll', this.calculateStickyState);\n    const detatchResize = addEvent('resize', this.onResize);\n\n    this._detatch = () => {\n      [detatchScroll, detatchResize].forEach((detatch) => detatch());\n      this._initialised = false;\n    };\n\n    this.calculateStickyState();\n    this._initialised = true;\n  }\n\n  render () {\n    const backgroundUrl = this.props.backgroundImage && `url('${this.props.backgroundImage}')`;\n    const headerClassName = `ReactStickyHeader_root${this.props.className ? ` ${this.props.className}` : ''}`;\n    const rootClassName = `${headerClassName}${this.state.isSticky ? ' is-sticky' : ''}`;\n    const headerContainerHeight = this._root && this._root.offsetHeight;\n    const fixedHeaderHeight = this._fixed && this._fixed.offsetHeight;\n\n    return (\n      <header className={rootClassName} ref={(e) => (this._root = e)}>\n        <div className=\"ReactStickyHeader_fixed\" ref={(e) => (this._fixed = e)}>\n          {this.props.header}\n        </div>\n\n        <div\n          className=\"ReactStickyHeader_midground\"\n          style={{\n            height: headerContainerHeight || fixedHeaderHeight,\n            top: fixedHeaderHeight,\n            backgroundImage: backgroundUrl,\n            backgroundColor: this.props.backgroundColor,\n          }}\n        />\n\n        {this.props.headerOnly && <div style={{ height: fixedHeaderHeight }} />}\n\n        {this.props.headerOnly || (\n          <div\n            className=\"ReactStickyHeader_background-bg\"\n            style={{ backgroundImage: backgroundUrl, backgroundColor: this.props.backgroundColor }}\n          />\n        )}\n\n        {this.props.headerOnly || (\n          <div\n            className=\"ReactStickyHeader_foreground\"\n            style={{ opacity: this.state.isSticky ? 0 : 1, backgroundImage: backgroundUrl, backgroundColor: this.props.backgroundColor }}\n          />\n        )}\n\n        {this.props.headerOnly || this.props.children}\n      </header>\n    );\n  }\n}\n"],"names":["addEvent","event","cb","window","addEventListener","removeEventListener","noop","ReactStickyHeader","_detatch","_rafExecuting","state","isSticky","props","headerOnly","calculateStickyState","requestAnimationFrame","stickyHeaderHeight","_fixed","offsetHeight","headerContainer","_root","headerContainerBoundingBox","getBoundingClientRect","pastStickyThreshold","top","setState","onSticky","onResize","initialise","nextProps","_initialised","detatchScroll","detatchResize","forEach","detatch","backgroundUrl","backgroundImage","headerClassName","className","rootClassName","headerContainerHeight","fixedHeaderHeight","React","e","header","height","backgroundColor","opacity","children","Component","defaultProps"],"mappings":"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"}